<!DOCTYPE html>
<html lang="en" dir="ltr" ng-app="HauntedApp">
  <head>
    <meta charset="utf-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.7.2/angular.min.js"></script>
    <script src="/js/app.js" charset="utf-8"></script>
    <title>Haunted Places</title>
  </head>

<!-- Second Controller for create user/session -->
  <header ng-controller="AuthController as auth">

    <!--Create User  -->
    <button ng-click="auth.toggleShowCreateUser(); auth.indexOfUserFormToShow = $index">Create User</button>

    <!-- <form ng-submit="auth.createUser()" ng-click="$indexOfUserFormToShow = $index"> -->
    <form ng-if="$index === auth.indexOfUserFormToShow && auth.showCreateUser"
    ng-submit="auth.createUser()">
      <input type ="text" ng-model="auth.username"/>
      <input type="password" ng-model="auth.password"/>
      <input type="submit" value="Become a Ghostly Ghoul"/>
    </form>


<!-- Log In -->
    <button ng-click="auth.toggleShowLogIn(); auth.indexOfLogInFormToShow = $index">Log In</button>

    <form ng-if="$index === auth.indexOfLogInFormToShow && auth.showLogIn"
    ng-submit="auth.showLogIn()">
      <input type = "text" ng-model="auth.username"/>
      <input type="password" ng-model="auth.password"/>
      <input ng-click="auth.goApp()" type ="submit" value ="Log in (if you dare)"/>

    <div ng-if="auth.loggedInUsername">
    <!-- <a href ="#" ng-click=>Click</a> -->
      Welcome, {{auth.loggedInUsername}}
    </div>
</form>
  </header>





  <body ng-controller="MainController as ctrl">

    <div class="container">
      <table>
        <tr ng-repeat="place in ctrl.places">
          <!-- WHEN USER CLICKS ON NAME, SHOW MODAL POPS UP -->
          <td>{{place.name}}</td>
          <td>{{place.location}}</td>
          <td><img src="{{place.image}}"></td>
          <td>{{place.description}}</td>

          <td><button ng-click ="ctrl.deletePlace(place)">Delete</button></td>
          <td><button ng-click="ctrl.indexOfEditFormToShow = $index">Edit</button></td>
          <td> <button ng-click="ctrl.showOnePlace(place)">See Details</button> </td>
          <!-- EDIT FORM -->
          <td><form
            ng-if="$index === ctrl.indexOfEditFormToShow"
            ng-submit="ctrl.editPlace(place);">
            Name: <input type="text" ng-model="ctrl.updatedName"  placeholder="Name"/>
            Location: <input type="text" ng-model="ctrl.updatedLocation" placeholder="Location"/>
            Image: <input type="text" ng-model="ctrl.updatedImage" placeholder="Image URL"/>
            Description: <input type="text" ng-model="ctrl.updatedDescription"  placeholder="Description"/>
            <input type="submit" value="Update Place"/>

          <td> <button ng-click="ctrl.deletePlace(place)">Delete</button></td>

    <td>
      <button ng-click="ctrl.toggleShowEditForm(place); ctrl.indexOfEditFormToShow = $index">Edit</button>

      <form ng-if="$index === ctrl.indexOfEditFormToShow && ctrl.showEditForm"
      ng-submit="ctrl.editPlace(place)">

        <form class="update-form" ng-if="ctrl.showEditForm" ng-submit="ctrl.editPlace(place)">

        <input type="text" ng-model="ctrl.updatedName"  placeholder="Name"/>
        <input type="text" ng-model="ctrl.updatedLocation" placeholder="Location"/>
        <input type="text" ng-model="ctrl.updatedImage" placeholder="Image URL"/>
        <input type="text" ng-model="ctrl.updatedDescription"  placeholder="Description"/>
        <input type="submit" value="Update Place"/>


        </form>
      </td>
    </tr>
  </table>



  <!-- CREATE NEW HAUNTED PLACE FORM -->
    <form ng-submit="ctrl.createPlace()">
      <input type="text" ng-model="ctrl.name" placeholder="name"/>
      <input type="text" ng-model="ctrl.location" placeholder="location"/>
      <input type="text" ng-model="ctrl.image" placeholder="img"/>
      <input type="text" ng-model="ctrl.description" placeholder="description"/>
      <input type = "submit" value = "Create New Haunted Place"/>
    </form>

    <!-- SHOW PAGE MODAL -->

    <div
      ng-if="ctrl.showModal === true"
       class="showModal">
      <a
        ng-click="ctrl.toggleModal(place)"
        href="#">x Close</a>
      <div class="showContents">
        <img src="{{ctrl.place.image}}" alt="An image of {{ctrl.place.name}}" />
        <h2>{{ctrl.place.name}}</h2>
        <label for="description">Description</label>
        <p>{{ctrl.place.description}}</p>
      </div>
    </div>




    </div>
  </body>
</html>
